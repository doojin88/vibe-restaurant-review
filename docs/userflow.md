# 유저플로우 명세

## 문서 개요
본 문서는 Restaurant Review 서비스의 모든 사용자 상호작용에 대한 상세한 플로우를 기술합니다.
각 플로우는 입력(Input) - 처리(Process) - 출력(Output) 단계로 구성되며, 발생 가능한 엣지케이스를 포함합니다.

---

## 1. 홈 화면 (지도 기반 장소 탐색)

### 1.1 초기 진입 및 지도 로딩

#### 입력
- 사용자가 홈 페이지 URL에 접속
- 브라우저가 위치 권한 요청

#### 처리
1. 페이지 컴포넌트 마운트
2. 로딩 스피너 표시
3. Geolocation API를 통해 현재 위치 조회 시도
4. 위치 조회 결과에 따라 분기:
   - **권한 허용됨**:
     - 현재 위치 좌표를 Zustand 스토어에 저장
     - 지도 중심을 현재 위치로 설정
   - **권한 거부됨**:
     - 기본 위치(서울시청: 37.5665, 126.9780)로 설정
     - 안내 메시지 표시 (위치 권한이 거부되었습니다)
   - **위치 조회 실패**:
     - 기본 위치로 폴백
     - 에러 로깅
5. 지도 SDK 초기화 및 렌더링
6. 현재 위치 마커 표시
7. React Query를 통해 리뷰가 존재하는 장소 목록 조회
   - API 호출: `GET /api/places/nearby?lat={lat}&lng={lng}&radius=1000`
8. 조회된 장소들에 대해 지도 마커 생성 및 표시

#### 출력
- **성공 시**:
  - 지도 뷰 표시 (현재 위치 중심)
  - 현재 위치 마커 표시 (고유 아이콘으로 구분)
  - 리뷰 존재 장소들의 마커 표시
  - 상단에 검색 바 고정 표시
  - 지도 컨트롤 버튼 표시 (확대/축소, 스케일바)
  - 로딩 스피너 제거
- **실패 시**:
  - 네트워크 에러 메시지 표시
  - 재시도 버튼 표시
  - 기본 지도 뷰 표시 (마커 없음)

#### 엣지케이스
- 브라우저가 Geolocation API를 지원하지 않는 경우: 기본 위치로 설정 및 안내 메시지
- 지도 SDK 로딩 실패: 에러 바운더리로 처리, 재로딩 버튼 제공
- 네트워크 오프라인 상태: 오프라인 안내 메시지 및 재시도 버튼
- 장소 데이터가 없는 경우: 빈 지도 표시, 안내 메시지 (주변에 등록된 리뷰가 없습니다)

---

### 1.2 지도 인터랙션 (드래그/줌)

#### 입력
- 사용자의 터치/마우스 드래그 제스처
- 확대/축소 버튼 클릭 또는 핀치 줌 제스처
- 지도 영역 더블 클릭/탭

#### 처리
1. 지도 SDK의 이벤트 핸들러 실행
2. 지도 중심 좌표 및 줌 레벨 변경
3. Zustand 스토어 업데이트 (새로운 중심 좌표, 줌 레벨)
4. 필요 시 debounce 처리하여 주변 장소 재조회
   - 중심 좌표가 특정 거리 이상 이동한 경우
   - API 호출: `GET /api/places/nearby?lat={new_lat}&lng={new_lng}&radius={calculated_radius}`
5. 새로운 장소 데이터 수신 시 기존 마커 제거 후 새 마커 추가

#### 출력
- 지도 뷰 갱신 (새로운 중심 및 줌 레벨)
- 마커 위치 갱신 (필요 시)
- 스케일바 갱신

#### 엣지케이스
- 빠른 연속 드래그: debounce 처리로 API 호출 최소화
- 최대/최소 줌 레벨 초과: 지도 SDK의 제한 범위 내에서 처리
- 지도 영역 밖으로 드래그: 지도 SDK의 기본 동작 유지

---

### 1.3 장소 마커 클릭

#### 입력
- 사용자가 지도 상의 장소 마커 클릭/탭

#### 처리
1. 마커 클릭 이벤트 핸들러 실행
2. 클릭된 마커의 장소 ID 추출
3. Next.js router를 사용하여 장소 상세 페이지로 네비게이션
   - 경로: `/place/{placeId}`
4. 페이지 전환 애니메이션 시작

#### 출력
- 장소 상세 페이지로 이동
- 브라우저 히스토리에 추가 (뒤로가기 가능)

#### 엣지케이스
- 존재하지 않는 장소 ID: 상세 페이지에서 404 처리
- 네트워크 지연: 로딩 상태 표시 유지
- 연속 빠른 클릭: 첫 번째 클릭만 처리 (debounce)

---

### 1.4 검색 바 활용

#### 입력
- 사용자가 검색 바 클릭/포커스
- 텍스트 입력 (키워드)
- 검색 버튼 클릭 또는 엔터 키 입력

#### 처리
1. 검색 바 포커스 상태로 전환
2. 입력된 키워드 실시간 검증
   - 최소 길이: 1자 이상
   - 최대 길이: 50자
3. 검색 트리거 (엔터 또는 버튼 클릭):
   - 입력값 trim 처리
   - 빈 문자열 체크
4. 유효한 경우:
   - 검색 쿼리 파라미터와 함께 검색 결과 페이지로 네비게이션
   - 경로: `/search?q={encodedKeyword}`
5. 검색 히스토리 로컬 스토리지에 저장 (선택적)

#### 출력
- **유효한 입력 시**:
  - 검색 결과 페이지/모달로 이동
  - URL 업데이트
- **무효한 입력 시**:
  - 에러 메시지 표시 (최소 1자 이상 입력해주세요)
  - 검색 바 포커스 유지

#### 엣지케이스
- 특수문자만 입력: 허용하되 검색 결과 없음으로 처리
- 공백만 입력: trim 후 빈 문자열로 판단, 에러 메시지
- 매우 긴 키워드 (50자 초과): 입력 제한 또는 잘림 처리
- 연속 빠른 검색: debounce 처리

---

## 2. 장소 검색 결과

### 2.1 검색 결과 표시

#### 입력
- URL 쿼리 파라미터: `q={keyword}`
- 페이지 진입 또는 검색 실행

#### 처리
1. 쿼리 파라미터에서 검색 키워드 추출
2. 키워드 디코딩 (URL 인코딩 해제)
3. React Query를 통해 검색 API 호출
   - `GET /api/places/search?q={keyword}&page=1&limit=10`
4. 로딩 상태 표시
5. 응답 데이터 수신 및 파싱:
   - Zod 스키마로 검증
   - 장소 배열 추출
6. 검색 결과에 따라 분기:
   - **결과 있음**: 장소 카드 리스트 렌더링
   - **결과 없음**: 빈 상태 UI 표시
7. 페이지네이션 정보 처리 (hasMore 플래그)

#### 출력
- **결과 있음**:
  - 상단: "검색 결과" 제목
  - 우측 상단: 닫기 버튼 (X 아이콘)
  - 장소 카드 리스트:
    - 각 카드에 가게명, 주소, 카테고리 표시
    - 리뷰 작성 버튼 표시
  - 결과 개수 표시 (총 N개)
  - 추가 결과 로드 버튼 (hasMore가 true인 경우)
- **결과 없음**:
  - 빈 상태 아이콘/이미지
  - 안내 메시지 (검색 결과가 없습니다)
  - 검색 키워드 재표시
  - 홈으로 돌아가기 버튼
- **에러 발생**:
  - 에러 아이콘
  - 오류 안내 메시지 (검색 중 오류가 발생했습니다)
  - 재시도 버튼

#### 엣지케이스
- 키워드가 쿼리 파라미터에 없는 경우: 홈으로 리다이렉트
- 네트워크 타임아웃: 재시도 옵션 제공
- 대량의 결과 (100개 이상): 페이지네이션 처리
- 특수문자 키워드: 서버에서 안전하게 이스케이프 처리

---

### 2.2 장소 카드 인터랙션

#### 입력
- 사용자가 특정 장소 카드 영역 클릭/탭 (리뷰 작성 버튼 제외)
- 또는 리뷰 작성 버튼 클릭/탭

#### 처리
1. 클릭 이벤트 타겟 확인:
   - **카드 영역 클릭**:
     - 장소 ID 추출
     - 장소 상세 페이지로 네비게이션 (`/place/{placeId}`)
   - **리뷰 작성 버튼 클릭**:
     - 장소 ID 추출
     - 리뷰 작성 페이지로 네비게이션 (`/place/{placeId}/review`)
2. 선택된 카드에 시각적 피드백 제공 (하이라이트)
3. 페이지 전환 시작

#### 출력
- **카드 클릭 시**:
  - 장소 상세 페이지로 이동
  - URL 업데이트
  - 브라우저 히스토리 추가
- **리뷰 작성 버튼 클릭 시**:
  - 리뷰 작성 페이지로 이동
  - 장소 기본 정보 전달 (컨텍스트 또는 state)
  - URL 업데이트

#### 엣지케이스
- 연속 빠른 클릭: 첫 번째 클릭만 처리
- 버튼 영역 외곽 클릭: 카드 클릭으로 처리
- 드래그 후 릴리즈: 클릭으로 간주하지 않음

---

### 2.3 무한 스크롤 / 페이지네이션

#### 입력
- 사용자가 리스트 하단까지 스크롤
- 또는 "더 보기" 버튼 클릭

#### 처리
1. 스크롤 위치 감지 (IntersectionObserver 사용)
2. hasMore 플래그 확인
3. 현재 로딩 중이 아닌 경우:
   - 다음 페이지 번호 계산
   - React Query의 fetchNextPage 호출
   - API 호출: `GET /api/places/search?q={keyword}&page={nextPage}&limit=10`
4. 로딩 스피너 표시
5. 응답 데이터를 기존 리스트에 병합
6. hasMore 플래그 업데이트

#### 출력
- 기존 리스트 하단에 새로운 장소 카드 추가
- 로딩 스피너 제거
- 스크롤 위치 유지
- 더 이상 결과가 없는 경우: "모든 결과를 불러왔습니다" 메시지

#### 엣지케이스
- 스크롤 중 네트워크 에러: 에러 메시지 및 재시도 버튼
- 마지막 페이지 도달: hasMore false로 설정, 추가 로딩 방지
- 빠른 연속 스크롤: 중복 API 호출 방지 (로딩 중 플래그)

---

### 2.4 검색 결과 닫기

#### 입력
- 사용자가 우측 상단 닫기 버튼 (X) 클릭
- 또는 브라우저 뒤로가기 버튼 클릭
- 또는 ESC 키 입력 (모달 형태인 경우)

#### 처리
1. 닫기 이벤트 핸들러 실행
2. 현재 히스토리 스택 확인
3. 이전 페이지가 홈인 경우:
   - router.back() 호출
4. 이전 페이지가 없거나 외부 사이트인 경우:
   - router.push('/') 호출
5. 검색 상태 초기화 (선택적)

#### 출력
- 이전 페이지 (주로 홈 화면)로 이동
- 지도 상태 복원 (이전 중심 좌표 및 줌 레벨)

#### 엣지케이스
- 직접 URL 입력으로 진입한 경우: 홈으로 이동
- 모달 형태인 경우 배경 클릭: 닫기 동작 수행

---

## 3. 장소 상세 페이지

### 3.1 장소 정보 로딩 및 표시

#### 입력
- URL 파라미터: `/place/{placeId}`
- 페이지 진입

#### 처리
1. URL에서 placeId 추출 (params를 Promise로 처리)
2. 두 개의 병렬 API 호출 (React Query):
   - `GET /api/places/{placeId}` (장소 정보 + 평점 요약)
   - `GET /api/places/{placeId}/reviews?page=1&limit=10` (리뷰 목록)
3. 로딩 상태 표시 (스켈레톤 UI)
4. 장소 데이터 응답 처리:
   - Zod 스키마 검증
   - 장소 정보 파싱 (id, name, address, category, latitude, longitude)
   - 평점 정보 파싱 (averageRating, reviewCount)
5. 리뷰 데이터 응답 처리:
   - Zod 스키마 검증
   - 리뷰 배열 파싱
   - 최신순 정렬 확인
6. 에러 응답 처리:
   - 404: 장소를 찾을 수 없음
   - 500: 서버 오류

#### 출력
- **성공 시**:
  - 상단: "장소 상세" 제목
  - 장소 정보 카드:
    - 가게명 (굵게)
    - 주소
    - 카테고리
  - 평점 요약 영역:
    - 평균 별점 (노란색 별 아이콘)
    - 리뷰 개수 (N개의 리뷰)
  - 리뷰 작성 버튼 (큰 CTA 버튼)
  - 리뷰 리스트:
    - 각 리뷰 카드에 작성자명, 평점, 작성일, 내용 표시
    - 본인 작성 리뷰인 경우 수정/삭제 버튼 표시
- **리뷰 없음**:
  - 빈 상태 UI
  - 안내 메시지 (등록된 리뷰가 없습니다)
  - 첫 리뷰 작성 유도 버튼
- **에러 시**:
  - 404: "장소를 찾을 수 없습니다" 메시지 + 홈으로 돌아가기
  - 500: "오류가 발생했습니다" 메시지 + 재시도 버튼

#### 엣지케이스
- 유효하지 않은 placeId (UUID 형식 아님): 404 처리
- 장소는 있으나 리뷰 조회 실패: 장소 정보만 표시, 리뷰 에러 메시지
- 평균 평점 계산 불가 (리뷰 0개): 평점 미표시 또는 "평가 없음"
- 매우 긴 리뷰 내용: 일정 길이 이상은 "더보기" 버튼으로 확장

---

### 3.2 리뷰 작성 버튼 클릭

#### 입력
- 사용자가 "리뷰 작성" 버튼 클릭/탭

#### 처리
1. 버튼 클릭 이벤트 핸들러 실행
2. 현재 장소 ID 확인
3. 리뷰 작성 페이지로 네비게이션
   - 경로: `/place/{placeId}/review`
4. 장소 기본 정보를 URL state 또는 컨텍스트로 전달 (선택적)

#### 출력
- 리뷰 작성 페이지로 이동
- URL 업데이트
- 브라우저 히스토리 추가

#### 엣지케이스
- 네트워크 지연: 버튼 로딩 상태 표시
- 연속 클릭: 첫 번째 클릭만 처리

---

### 3.3 리뷰 목록 스크롤 및 페이지네이션

#### 입력
- 사용자가 리뷰 리스트를 스크롤하여 하단 도달
- hasMore 플래그가 true

#### 처리
1. IntersectionObserver로 리스트 하단 감지
2. 현재 로딩 중이 아닌 경우:
   - 다음 페이지 번호 계산
   - React Query의 fetchNextPage 호출
   - API 호출: `GET /api/places/{placeId}/reviews?page={nextPage}&limit=10`
3. 로딩 스피너 표시
4. 응답 데이터를 기존 리뷰 리스트에 병합
5. hasMore 플래그 업데이트

#### 출력
- 기존 리뷰 리스트 하단에 새로운 리뷰 추가
- 로딩 스피너 제거
- 스크롤 위치 유지

#### 엣지케이스
- 마지막 페이지 도달: "모든 리뷰를 불러왔습니다" 메시지
- 네트워크 에러: 재시도 버튼
- 중복 API 호출 방지

---

### 3.4 본인 리뷰 수정/삭제

#### 입력
- 사용자가 본인이 작성한 리뷰의 수정/삭제 버튼 클릭

#### 처리
**수정 플로우:**
1. 수정 버튼 클릭 이벤트
2. 비밀번호 입력 모달/다이얼로그 표시
3. 사용자 비밀번호 입력
4. 비밀번호 검증 API 호출:
   - `PUT /api/reviews/{reviewId}` (비밀번호 포함)
   - 서버에서 bcrypt로 비밀번호 검증
5. 검증 성공 시:
   - 리뷰 수정 폼 모달 표시
   - 기존 내용 pre-fill
6. 사용자가 내용 수정 후 저장
7. API 호출: `PUT /api/reviews/{reviewId}` (수정된 데이터)
8. React Query 캐시 무효화 및 재조회

**삭제 플로우:**
1. 삭제 버튼 클릭 이벤트
2. 확인 다이얼로그 표시 (정말 삭제하시겠습니까?)
3. 확인 시 비밀번호 입력 모달 표시
4. 사용자 비밀번호 입력
5. API 호출: `DELETE /api/reviews/{reviewId}` (비밀번호 포함)
6. 서버에서 비밀번호 검증 및 삭제 처리
7. 성공 시 React Query 캐시 무효화 및 재조회

#### 출력
**수정 성공 시**:
- 성공 토스트 메시지 (리뷰가 수정되었습니다)
- 리뷰 리스트 즉시 갱신
- 모달 닫기

**삭제 성공 시**:
- 성공 토스트 메시지 (리뷰가 삭제되었습니다)
- 해당 리뷰 카드 fade-out 애니메이션 후 제거
- 리뷰 개수 및 평균 평점 갱신

**실패 시**:
- 비밀번호 불일치: "비밀번호가 일치하지 않습니다" 에러 메시지
- 네트워크 에러: "오류가 발생했습니다. 다시 시도해주세요"
- 모달 유지 (재시도 가능)

#### 엣지케이스
- 리뷰가 이미 삭제된 경우 (동시 삭제): 404 에러, 리스트 재조회
- 비밀번호 3회 이상 오류: 일시적 잠금 또는 CAPTCHA (선택적)
- 수정 중 다른 사용자가 삭제: 409 Conflict 처리
- 본인 리뷰 식별: 로컬 스토리지에 작성한 리뷰 ID 목록 저장

---

## 4. 리뷰 작성 페이지

### 4.1 리뷰 작성 폼 로딩

#### 입력
- URL 파라미터: `/place/{placeId}/review`
- 페이지 진입

#### 처리
1. URL에서 placeId 추출
2. 장소 기본 정보 조회 API 호출:
   - `GET /api/places/{placeId}`
3. 로딩 상태 표시
4. 장소 데이터 응답 처리:
   - 가게명, 주소, 카테고리 추출
5. react-hook-form 초기화:
   - Zod 스키마 (CreateReviewSchema) 연결
   - 기본값 설정 (authorName: '', rating: 0, content: '', password: '')
6. 폼 렌더링

#### 출력
- 상단: 뒤로가기 버튼 + "리뷰 작성" 제목
- 장소 정보 카드 (읽기 전용):
  - 가게명
  - 주소
  - 카테고리
- 리뷰 입력 폼:
  - 작성자명 입력 필드 (이메일 형식, 최대 20자)
  - 평점 선택 (별 1~5개, 클릭/탭으로 선택)
  - 리뷰 내용 텍스트 영역 (10~500자)
    - 실시간 글자 수 표시 (0/500)
  - 비밀번호 입력 필드 (마스킹, 최소 4자)
- 리뷰 작성하기 버튼 (초기 비활성화)

#### 엣지케이스
- 유효하지 않은 placeId: 404 처리, 홈으로 리다이렉트
- 장소 조회 실패: 에러 메시지, 재시도 또는 뒤로가기
- 이전 페이지에서 장소 정보 전달된 경우: API 호출 생략 (최적화)

---

### 4.2 폼 입력 및 실시간 검증

#### 입력
- 사용자가 각 필드에 텍스트 입력 또는 선택

#### 처리
1. **작성자명 입력**:
   - onChange 이벤트로 값 캡처
   - react-hook-form 상태 업데이트
   - Zod 스키마 실시간 검증:
     - 이메일 형식 체크
     - 최대 20자 체크
   - 에러 발생 시 에러 메시지 표시

2. **평점 선택**:
   - 별 아이콘 클릭 이벤트
   - 선택된 별 개수 (1~5) 상태 업데이트
   - 시각적 피드백 (선택된 별 색상 변경)

3. **리뷰 내용 입력**:
   - onChange 이벤트로 값 캡처
   - 현재 글자 수 계산 및 표시
   - Zod 스키마 검증:
     - 최소 10자 체크
     - 최대 500자 체크
   - 500자 초과 시 입력 차단 또는 에러 메시지

4. **비밀번호 입력**:
   - onChange 이벤트로 값 캡처
   - 마스킹 처리 (type="password")
   - Zod 스키마 검증:
     - 최소 4자 체크

5. 모든 필수 필드 검증 통과 여부 확인:
   - react-hook-form의 isValid 상태 업데이트
   - 제출 버튼 활성화/비활성화 토글

#### 출력
- 각 필드 하단에 실시간 에러 메시지 표시/제거:
  - 작성자명: "이메일 형식이 아닙니다", "최대 20자까지 입력 가능합니다"
  - 평점: (에러 메시지 없음, 선택 필수)
  - 리뷰 내용: "최소 10자 이상 입력해주세요", "최대 500자까지 입력 가능합니다"
  - 비밀번호: "최소 4자 이상 입력해주세요"
- 글자 수 카운터 실시간 업데이트 (예: 125/500)
- 리뷰 작성하기 버튼 상태:
  - 모든 필드 유효: 활성화 (파란색, 클릭 가능)
  - 하나라도 무효: 비활성화 (회색, 클릭 불가)

#### 엣지케이스
- 붙여넣기로 500자 초과 입력: 자동 잘림 또는 에러
- 이모지 입력: 글자 수 정확히 계산 (유니코드 길이)
- 공백만 입력: trim 후 길이 체크
- 비밀번호 복사: 방지 (선택적, UX 고려)

---

### 4.3 리뷰 작성 제출

#### 입력
- 사용자가 "리뷰 작성하기" 버튼 클릭/탭
- 모든 필드 검증 통과 상태

#### 처리
1. 폼 제출 이벤트 (form.handleSubmit)
2. 최종 Zod 스키마 검증 수행
3. 검증 통과 시:
   - 제출 버튼 로딩 상태로 전환 (스피너 표시)
   - 비밀번호 해싱 (bcrypt, 백엔드에서 처리)
   - React Query mutation 호출
   - API 호출: `POST /api/places/{placeId}/reviews`
     - Body: { authorName, rating, content, password }
4. 백엔드 처리:
   - 장소 존재 여부 확인
   - 요청 데이터 Zod 검증
   - 비밀번호 bcrypt 해싱
   - Supabase에 리뷰 삽입
   - 장소의 평균 평점 재계산 (트리거 또는 수동)
5. 응답 수신:
   - 성공: 리뷰 ID 및 데이터 반환
   - 실패: 에러 코드 및 메시지 반환
6. 성공 시:
   - React Query 캐시 무효화:
     - `['place', placeId]` (평점 갱신)
     - `['reviews', placeId]` (리뷰 목록 갱신)
   - 작성한 리뷰 ID를 로컬 스토리지에 저장 (본인 리뷰 식별용)
   - 성공 토스트 메시지 표시
   - 장소 상세 페이지로 네비게이션
7. 실패 시:
   - 에러 메시지 표시
   - 제출 버튼 로딩 해제

#### 출력
- **성공 시**:
  - 토스트 메시지: "리뷰가 등록되었습니다"
  - 장소 상세 페이지로 자동 이동
  - 방금 작성한 리뷰가 리스트 최상단에 표시
  - 평균 평점 및 리뷰 개수 갱신
- **실패 시**:
  - 에러 토스트 또는 인라인 메시지:
    - `PLACE_NOT_FOUND`: "장소를 찾을 수 없습니다"
    - `VALIDATION_FAILED`: "입력 정보를 확인해주세요"
    - `REVIEW_CREATE_FAILED`: "리뷰 작성에 실패했습니다. 다시 시도해주세요"
  - 폼 유지 (입력값 보존)
  - 제출 버튼 재활성화

#### 엣지케이스
- 네트워크 타임아웃: 재시도 옵션 제공
- 중복 제출 방지: 로딩 중 버튼 비활성화 유지
- 장소가 삭제된 경우: 404 에러, 홈으로 리다이렉트
- 동일 사용자 중복 리뷰: 허용 (비로그인 서비스이므로 제한 어려움)
- 비밀번호 해싱 실패: 서버 에러, 재시도 유도

---

### 4.4 뒤로가기 / 취소

#### 입력
- 사용자가 상단 뒤로가기 버튼 클릭
- 또는 브라우저 뒤로가기 버튼 클릭

#### 처리
1. 입력 중인 데이터 확인:
   - 폼이 dirty 상태인지 체크 (react-hook-form의 isDirty)
2. dirty 상태인 경우:
   - 확인 다이얼로그 표시: "작성 중인 내용이 있습니다. 정말 나가시겠습니까?"
   - 확인: 페이지 이탈
   - 취소: 모달 닫기, 폼 유지
3. dirty 상태가 아닌 경우:
   - 즉시 이전 페이지로 이동
4. router.back() 또는 router.push() 호출

#### 출력
- 이전 페이지로 이동 (주로 장소 상세 또는 검색 결과)
- 작성 중인 데이터 손실

#### 엣지케이스
- 직접 URL로 진입한 경우: 장소 상세 페이지로 이동
- 브라우저 새로고침 경고: beforeunload 이벤트 처리 (선택적)

---

## 5. 공통 엣지케이스 및 오류 처리

### 5.1 네트워크 오류

#### 발생 상황
- API 호출 중 네트워크 연결 끊김
- 타임아웃 초과
- 서버 응답 지연

#### 처리
1. React Query의 retry 로직 활용 (최대 3회)
2. 모든 재시도 실패 시:
   - 에러 바운더리로 전파 또는 컴포넌트 레벨 처리
3. 사용자에게 에러 UI 표시:
   - 에러 아이콘
   - 명확한 메시지 (네트워크 연결을 확인해주세요)
   - 재시도 버튼
4. 재시도 버튼 클릭 시:
   - React Query의 refetch 호출
   - 로딩 상태 재표시

#### 출력
- 에러 토스트 또는 인라인 메시지
- 재시도 버튼
- 로딩 상태 해제

---

### 5.2 인증/권한 오류 (미래 확장)

#### 발생 상황
- 현재는 비로그인 서비스이므로 해당 없음
- 향후 인증 도입 시 고려사항

#### 처리
- 401 Unauthorized: 로그인 페이지로 리다이렉트
- 403 Forbidden: 권한 없음 메시지

---

### 5.3 데이터 무결성 오류

#### 발생 상황
- Zod 스키마 검증 실패 (서버 응답이 예상 형식과 다름)
- 필수 필드 누락

#### 처리
1. try-catch 블록으로 파싱 에러 캡처
2. 에러 로깅 (Sentry 등)
3. 사용자에게 일반적인 에러 메시지 표시
4. 폴백 UI 또는 기본값 사용

#### 출력
- "일시적인 오류가 발생했습니다" 메시지
- 재시도 또는 홈으로 돌아가기 옵션

---

### 5.4 브라우저 호환성

#### 발생 상황
- 구형 브라우저에서 Geolocation API 미지원
- 지도 SDK 미지원
- CSS Grid/Flexbox 미지원

#### 처리
1. Feature detection 수행
2. Polyfill 적용 (필요 시)
3. 대체 UI 제공:
   - Geolocation 미지원: 수동 위치 입력 또는 기본 위치 사용
   - 지도 SDK 미지원: 정적 이미지 또는 리스트 뷰
4. 브라우저 업데이트 안내 배너 (선택적)

#### 출력
- 호환성 안내 메시지
- 대체 기능 제공

---

### 5.5 성능 저하

#### 발생 상황
- 대량의 마커 렌더링 (100개 이상)
- 긴 리뷰 리스트
- 느린 네트워크 환경

#### 처리
1. 마커 클러스터링 적용 (지도 SDK 기능)
2. 가상화 스크롤 (react-window 등)
3. 이미지 레이지 로딩
4. debounce/throttle 적용 (검색, 스크롤)
5. 코드 스플리팅 및 lazy loading

#### 출력
- 부드러운 UX 유지
- 로딩 스켈레톤 또는 스피너

---

## 6. 접근성 (a11y) 고려사항

### 6.1 키보드 네비게이션
- 모든 인터랙티브 요소 Tab으로 접근 가능
- Enter/Space로 버튼 활성화
- ESC로 모달 닫기

### 6.2 스크린 리더
- ARIA 라벨 적용 (버튼, 입력 필드)
- 랜드마크 역할 정의 (header, main, navigation)
- 에러 메시지 aria-live로 즉시 알림

### 6.3 시각적 접근성
- 충분한 색상 대비 (WCAG AA 이상)
- 포커스 인디케이터 명확히 표시
- 아이콘에 텍스트 라벨 병기

---

## 부록: 상태 다이어그램

```
[홈 화면]
   ├─ 지도 로딩 중
   ├─ 지도 표시
   ├─ 검색 중
   └─ 검색 결과 표시

[검색 결과]
   ├─ 로딩 중
   ├─ 결과 표시
   ├─ 빈 상태
   └─ 에러 상태

[장소 상세]
   ├─ 로딩 중
   ├─ 정보 표시
   ├─ 리뷰 로딩 중
   ├─ 리뷰 표시
   ├─ 리뷰 없음
   └─ 에러 상태

[리뷰 작성]
   ├─ 폼 입력 중
   ├─ 제출 중
   ├─ 성공
   └─ 실패
```

---

**문서 버전**: 1.0.0
**작성일**: 2025-10-21
**작성자**: AI Agent
